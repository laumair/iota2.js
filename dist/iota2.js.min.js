!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("cross-fetch"),require("tweetnacl"),require("blakejs"),require("ed25519-hd-key")):"function"==typeof define&&define.amd?define(["exports","cross-fetch","tweetnacl","blakejs","ed25519-hd-key"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Iota2={},e["cross-fetch"],e.tweetnacl,e.blakejs,e["ed25519-hd-key"])}(this,(function(e,t,n,r,i){"use strict";function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=o(t),a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function u(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{u(r.next(e))}catch(e){o(e)}}function a(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}u((r=r.apply(e,t||[])).next())}))}function d(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}var c=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.route=n,o.httpStatus=r,o.code=i,o}return function(e,t){function n(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t}(Error),l=function(){function e(e){if(!/^https?:\/\/\w+(\.\w+)*(:\d+)?(\/.*)?$/.test(e))throw new Error("The endpoint is not in the correct format");this._endpoint=e.replace(/\/+$/,"")}return e.prototype.health=function(){return u(this,void 0,Promise,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return[4,this.fetchStatus("/health")];case 1:if(200===(e=t.sent()))return[2,!0];if(503===e)return[2,!1];throw new c("Unexpected response code","/health",e)}}))}))},e.prototype.info=function(){return u(this,void 0,Promise,(function(){return d(this,(function(e){return[2,this.fetchJson("get","/api/v1/info")]}))}))},e.prototype.tips=function(){return u(this,void 0,Promise,(function(){return d(this,(function(e){return[2,this.fetchJson("get","/api/v1/tips")]}))}))},e.prototype.message=function(e){return u(this,void 0,Promise,(function(){return d(this,(function(t){return[2,this.fetchJson("get","/api/v1/messages/"+e)]}))}))},e.prototype.messageMetadata=function(e){return u(this,void 0,Promise,(function(){return d(this,(function(t){return[2,this.fetchJson("get","/api/v1/messages/"+e+"/metadata")]}))}))},e.prototype.messageRaw=function(e){return u(this,void 0,Promise,(function(){return d(this,(function(t){return[2,this.fetchBinary("get","/api/v1/messages/"+e+"/raw")]}))}))},e.prototype.messageSubmit=function(e){return u(this,void 0,Promise,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this.fetchJson("post","/api/v1/messages",e)];case 1:return[2,t.sent().messageId]}}))}))},e.prototype.messageSubmitRaw=function(e){return u(this,void 0,Promise,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,this.fetchBinary("post","/api/v1/messages",e)];case 1:return[2,t.sent().messageId]}}))}))},e.prototype.messagesFind=function(e){return u(this,void 0,Promise,(function(){return d(this,(function(t){return[2,this.fetchJson("get","/api/v1/messages?index="+encodeURIComponent(e))]}))}))},e.prototype.messageChildren=function(e){return u(this,void 0,Promise,(function(){return d(this,(function(t){return[2,this.fetchJson("get","/api/v1/messages/"+e+"/children")]}))}))},e.prototype.output=function(e){return u(this,void 0,Promise,(function(){return d(this,(function(t){return[2,this.fetchJson("get","/api/v1/outputs/"+e)]}))}))},e.prototype.address=function(e){return u(this,void 0,Promise,(function(){return d(this,(function(t){return[2,this.fetchJson("get","/api/v1/addresses/"+e)]}))}))},e.prototype.addressOutputs=function(e){return u(this,void 0,Promise,(function(){return d(this,(function(t){return[2,this.fetchJson("get","/api/v1/addresses/"+e+"/outputs")]}))}))},e.prototype.milestone=function(e){return u(this,void 0,Promise,(function(){return d(this,(function(t){return[2,this.fetchJson("get","/api/v1/milestones/"+e)]}))}))},e.prototype.fetchStatus=function(e){return u(this,void 0,Promise,(function(){return d(this,(function(t){switch(t.label){case 0:return[4,s.default(""+this._endpoint+e,{method:"get"})];case 1:return[2,t.sent().status]}}))}))},e.prototype.fetchJson=function(e,t,n){var r,i,o;return u(this,void 0,Promise,(function(){var a,u;return d(this,(function(d){switch(d.label){case 0:return[4,s.default(""+this._endpoint+t,{method:e,headers:{"Content-Type":"application/json"},body:n?JSON.stringify(n):void 0})];case 1:return[4,(a=d.sent()).json()];case 2:if(u=d.sent(),a.ok&&!u.error)return[2,u.data];throw new c(null!==(i=null===(r=u.error)||void 0===r?void 0:r.message)&&void 0!==i?i:a.statusText,t,a.status,null===(o=u.error)||void 0===o?void 0:o.code)}}))}))},e.prototype.fetchBinary=function(e,t,n){var r,i,o;return u(this,void 0,Promise,(function(){var a,u,l,f;return d(this,(function(d){switch(d.label){case 0:return[4,s.default(""+this._endpoint+t,{method:e,headers:{"Content-Type":"application/octet-stream"},body:n})];case 1:return(a=d.sent()).ok?"get"!==e?[3,3]:(f=(l=Buffer).from,[4,a.arrayBuffer()]):[3,5];case 2:return[2,f.apply(l,[d.sent()])];case 3:return[4,a.json()];case 4:if(!(null==(u=d.sent())?void 0:u.error))return[2,null==u?void 0:u.data];d.label=5;case 5:return u?[3,7]:[4,a.json()];case 6:u=d.sent(),d.label=7;case 7:throw new c(null!==(i=null===(r=null==u?void 0:u.error)||void 0===r?void 0:r.message)&&void 0!==i?i:a.statusText,t,a.status,null===(o=null==u?void 0:u.error)||void 0===o?void 0:o.code)}}))}))},e}(),f=function(){function e(){}return e.sum256=function(t){return Buffer.from(r.blake2b(Buffer.from(t,"hex"),void 0,e.SIZE_256)).toString("hex")},e.SIZE_256=32,e}(),h=function(){function e(){}return e.signData=function(e,t){return Buffer.from(n.sign.detached(t,Buffer.from(e,"hex"))).toString("hex")},e.verifyData=function(e,t,r){return n.sign.detached.verify(r,Buffer.from(t,"hex"),Buffer.from(e,"hex"))},e.signAddress=function(e){return f.sum256(e)},e.verifyAddress=function(t,n){return e.signAddress(t)===n},e.VERSION=1,e.PUBLIC_KEY_SIZE=32,e.SIGNATURE_SIZE=64,e.ADDRESS_LENGTH=f.SIZE_256,e}(),p=f.SIZE_256,g=f.SIZE_256;function y(e){return e.length%2!=1&&/[\da-f]/gi.test(e)}var m=1+h.ADDRESS_LENGTH;function I(e){if(!e.hasRemaining(1))throw new Error("Address data is "+e.length()+" in length which is less than the minimimum size required of 1");var t=e.readByte("address.type",!1);if(1!==t)throw new Error("Unrecognized address type "+t);return E(e)}function w(e,t){if(1!==t.type)throw new Error("Unrecognized address type "+t.type);x(e,t)}function E(e){if(!e.hasRemaining(m))throw new Error("Ed25519 address data is "+e.length()+" in length which is less than the minimimum size required of "+m);var t=e.readByte("ed25519Address.type");if(1!==t)throw new Error("Type mismatch in ed25519Address "+t);return{type:t,address:e.readFixedBufferHex("ed25519Address.address",h.ADDRESS_LENGTH)}}function x(e,t){e.writeByte("ed25519Address.type",t.type),e.writeFixedBufferHex("ed25519Address.address",h.ADDRESS_LENGTH,t.address)}var _=1+g+2;function v(e){for(var t=e.readUInt16("inputs.numInputs"),n=[],r=0;r<t;r++)n.push(B(e));return n}function S(e,t){e.writeUInt16("inputs.numInputs",t.length);for(var n=0;n<t.length;n++)U(e,t[n])}function B(e){if(!e.hasRemaining(1))throw new Error("Input data is "+e.length()+" in length which is less than the minimimum size required of 1");var t=e.readByte("input.type",!1);if(0!==t)throw new Error("Unrecognized input type "+t);return k(e)}function U(e,t){if(0!==t.type)throw new Error("Unrecognized input type "+t.type);b(e,t)}function k(e){if(!e.hasRemaining(_))throw new Error("UTXO Input data is "+e.length()+" in length which is less than the minimimum size required of "+_);var t=e.readByte("utxoInput.type");if(0!==t)throw new Error("Type mismatch in utxoInput "+t);return{type:t,transactionId:e.readFixedBufferHex("utxoInput.transactionId",g),transactionOutputIndex:e.readUInt16("utxoInput.transactionOutputIndex")}}function b(e,t){e.writeByte("utxoInput.type",t.type),e.writeFixedBufferHex("utxoInput.transactionId",g,t.transactionId),e.writeUInt16("utxoInput.transactionOutputIndex",t.transactionOutputIndex)}var T=2+m;function N(e){for(var t=e.readUInt16("outputs.numOutputs"),n=[],r=0;r<t;r++)n.push(z(e));return n}function P(e,t){e.writeUInt16("outputs.numOutputs",t.length);for(var n=0;n<t.length;n++)M(e,t[n])}function z(e){if(!e.hasRemaining(1))throw new Error("Output data is "+e.length()+" in length which is less than the minimimum size required of 1");var t=e.readByte("output.type",!1);if(0!==t)throw new Error("Unrecognized output type "+t);return L(e)}function M(e,t){if(0!==t.type)throw new Error("Unrecognized output type "+t.type);O(e,t)}function L(e){if(!e.hasRemaining(T))throw new Error("Signature Locked Single Output data is "+e.length()+" in length which is less than the minimimum size required of "+T);var t=e.readByte("sigLockedSingleOutput.type");if(0!==t)throw new Error("Type mismatch in sigLockedSingleOutput "+t);var n=I(e),r=e.readUInt64("sigLockedSingleOutput.amount");return{type:t,address:n,amount:Number(r)}}function O(e,t){e.writeByte("sigLockedSingleOutput.type",t.type),w(e,t.address),e.writeUInt64("sigLockedSingleOutput.amount",BigInt(t.amount))}function R(e){if(!e.hasRemaining(12))throw new Error("Transaction essence data is "+e.length()+" in length which is less than the minimimum size required of 12");var t=e.readUInt32("transactionEssence.type");if(0!==t)throw new Error("Type mismatch in transactionEssence "+t);var n=v(e),r=N(e),i=$(e);if(i&&2!==i.type)throw new Error("Transaction essence can only contain embedded Indexation Payload");return{type:t,inputs:n,outputs:r,payload:i}}function A(e,t){e.writeUInt32("transactionEssence.type",t.type),S(e,t.inputs),P(e,t.outputs),V(e,t.payload)}var H=1+h.SIGNATURE_SIZE+h.PUBLIC_KEY_SIZE;function K(e){if(!e.hasRemaining(1))throw new Error("Signature data is "+e.length()+" in length which is less than the minimimum size required of 1");var t=e.readByte("signature.type",!1);if(1!==t)throw new Error("Unrecognized signature type "+t);return D(e)}function G(e,t){if(1!==t.type)throw new Error("Unrecognized signature type "+t.type);C(e,t)}function D(e){if(!e.hasRemaining(H))throw new Error("Ed25519 signature data is "+e.length()+" in length which is less than the minimimum size required of "+H);var t=e.readByte("ed25519Signature.type");if(1!==t)throw new Error("Type mismatch in ed25519Signature "+t);return{type:t,publicKey:e.readFixedBufferHex("ed25519Signature.publicKey",h.PUBLIC_KEY_SIZE),signature:e.readFixedBufferHex("ed25519Signature.signature",h.SIGNATURE_SIZE)}}function C(e,t){e.writeByte("ed25519Signature.type",t.type),e.writeFixedBufferHex("ed25519Signature.publicKey",h.PUBLIC_KEY_SIZE,t.publicKey),e.writeFixedBufferHex("ed25519Signature.signature",h.SIGNATURE_SIZE,t.signature)}function q(e){for(var t=e.readUInt16("transactionEssence.numUnlockBlocks"),n=[],r=0;r<t;r++)n.push(Z(e));return n}function F(e,t){e.writeUInt16("transactionEssence.numUnlockBlocks",t.length);for(var n=0;n<t.length;n++)Y(e,t[n])}function Z(e){if(!e.hasRemaining(1))throw new Error("Unlock Block data is "+e.length()+" in length which is less than the minimimum size required of 1");var t,n=e.readByte("unlockBlock.type",!1);if(0===n)t=j(e);else{if(1!==n)throw new Error("Unrecognized unlock block type "+n);t=W(e)}return t}function Y(e,t){if(0===t.type)J(e,t);else{if(1!==t.type)throw new Error("Unrecognized unlock block type "+t.type);X(e,t)}}function j(e){if(!e.hasRemaining(2))throw new Error("Signature Unlock Block data is "+e.length()+" in length which is less than the minimimum size required of 2");var t=e.readByte("signatureUnlockBlock.type");if(0!==t)throw new Error("Type mismatch in signatureUnlockBlock "+t);return{type:t,signature:K(e)}}function J(e,t){e.writeByte("signatureUnlockBlock.type",t.type),G(e,t.signature)}function W(e){if(!e.hasRemaining(3))throw new Error("Reference Unlock Block data is "+e.length()+" in length which is less than the minimimum size required of 3");var t=e.readByte("referenceUnlockBlock.type");if(1!==t)throw new Error("Type mismatch in referenceUnlockBlock "+t);return{type:t,reference:e.readUInt16("referenceUnlockBlock.reference")}}function X(e,t){e.writeByte("referenceUnlockBlock.type",t.type),e.writeUInt16("referenceUnlockBlock.reference",t.reference)}function $(e){if(!e.hasRemaining(4))throw new Error("Payload data is "+e.length()+" in length which is less than the minimimum size required of 4");var t,n=e.readUInt32("payload.length");if(!e.hasRemaining(n))throw new Error("Payload length "+n+" exceeds the remaining data "+e.unused());if(n>0){var r=e.readUInt32("payload.type",!1);if(0===r)t=Q(e);else if(1===r)t=te(e);else{if(2!==r)throw new Error("Unrecognized payload type "+r);t=re(e)}}return t}function V(e,t){var n=e.getWriteIndex();if(e.writeUInt32("payload.length",0),t)if(0===t.type)ee(e,t);else if(1===t.type)ne(e,t);else{if(2!==t.type)throw new Error("Unrecognized transaction type "+t.type);ie(e,t)}else;var r=e.getWriteIndex();e.setWriteIndex(n),e.writeUInt32("payload.length",r-n-4),e.setWriteIndex(r)}function Q(e){if(!e.hasRemaining(8))throw new Error("Transaction Payload data is "+e.length()+" in length which is less than the minimimum size required of 8");var t=e.readUInt32("payloadTransaction.type");if(0!==t)throw new Error("Type mismatch in payloadTransaction "+t);if(0!==e.readUInt32("payloadTransaction.essenceType",!1))throw new Error("Unrecognized transaction essence type "+t);return{type:t,essence:R(e),unlockBlocks:q(e)}}function ee(e,t){if(e.writeUInt32("payloadMilestone.type",t.type),0!==t.type)throw new Error("Unrecognized transaction type "+t.type);A(e,t.essence),F(e,t.unlockBlocks)}function te(e){if(!e.hasRemaining(148))throw new Error("Milestone Payload data is "+e.length()+" in length which is less than the minimimum size required of 148");var t=e.readUInt32("payloadMilestone.type");if(1!==t)throw new Error("Type mismatch in payloadMilestone "+t);var n=e.readUInt64("payloadMilestone.index"),r=e.readUInt64("payloadMilestone.timestamp"),i=e.readFixedBufferHex("payloadMilestone.inclusionMerkleProof",64),o=e.readFixedBufferHex("payloadMilestone.signature",64);return{type:t,index:Number(n),timestamp:Number(r),inclusionMerkleProof:i,signature:o}}function ne(e,t){e.writeUInt32("payloadMilestone.type",t.type),e.writeUInt64("payloadMilestone.index",BigInt(t.index)),e.writeUInt64("payloadMilestone.timestamp",BigInt(t.timestamp)),e.writeFixedBufferHex("payloadMilestone.inclusionMerkleProof",64,t.inclusionMerkleProof),e.writeFixedBufferHex("payloadMilestone.signature",64,t.signature)}function re(e){if(!e.hasRemaining(8))throw new Error("Indexation Payload data is "+e.length()+" in length which is less than the minimimum size required of 8");var t=e.readUInt32("payloadIndexation.type");if(2!==t)throw new Error("Type mismatch in payloadIndexation "+t);var n=e.readString("payloadIndexation.index"),r=e.readUInt32("payloadIndexation.dataLength");return{type:2,index:n,data:e.readFixedBufferHex("payloadIndexation.data",r)}}function ie(e,t){e.writeUInt32("payloadIndexation.type",t.type),e.writeString("payloadIndexation.index",t.index),e.writeUInt32("payloadIndexation.dataLength",t.data.length/2),e.writeFixedBufferHex("payloadIndexation.data",t.data.length/2,t.data)}var oe=1+2*p+4+8;var se=function(){function e(e){if(this._path=[],e){if(!/^m((?:\/\d+')*)$/.test(e))throw new Error("Bip32 Path is not in correct format");this._path=e.slice(2).replace(/'/g,"").split("/").map((function(e){return Number.parseInt(e,10)}))}}return e.prototype.toString=function(){return"m/"+this._path.map((function(e){return e+"'"})).join("/")},e.prototype.push=function(e){this._path.push(e)},e.prototype.pop=function(){return this._path.pop()},e}(),ae=function(){function e(){this._buffer=Buffer.alloc(e.CHUNK_SIZE),this._writeIndex=0}return e.prototype.length=function(){return this._buffer.length},e.prototype.unused=function(){return this._buffer.length-this._writeIndex},e.prototype.finalBuffer=function(){return this._buffer.slice(0,this._writeIndex)},e.prototype.getWriteIndex=function(){return this._writeIndex},e.prototype.setWriteIndex=function(e){this._writeIndex=e},e.prototype.writeFixedBufferHex=function(e,t,n){if(!y(n))throw new Error("The "+n+" should be in hex format");if(2*t!==n.length)throw new Error(e+" length "+n.length+" does not match expected length "+2*t);this.expand(t),this._buffer.write(n,this._writeIndex,"hex"),this._writeIndex+=t},e.prototype.writeByte=function(e,t){this.expand(1),this._buffer.writeUInt8(t,this._writeIndex),this._writeIndex+=1},e.prototype.writeUInt16=function(e,t){this.expand(2),this._buffer.writeUInt16LE(t,this._writeIndex),this._writeIndex+=2},e.prototype.writeUInt32=function(e,t){this.expand(4),this._buffer.writeUInt32LE(t,this._writeIndex),this._writeIndex+=4},e.prototype.writeUInt64=function(e,t){this.expand(8),this._buffer.writeBigUInt64LE(t,this._writeIndex),this._writeIndex+=8},e.prototype.writeString=function(e,t){return this.writeUInt16(e,t.length),this.expand(t.length),this._buffer.write(t,this._writeIndex),this._writeIndex+=t.length,t},e.prototype.expand=function(t){this._writeIndex+t>this._buffer.byteLength&&(this._buffer=Buffer.concat([this._buffer,Buffer.alloc(e.CHUNK_SIZE)]))},e.CHUNK_SIZE=4096,e}();function ue(e,t,n){for(var r=[],i=t;i<t+n;i++)if(0===i)r.push(e.generateKeyPair());else{var o=new se;o.push(i);var s=e.generateSubseed(o);r.push(s.generateKeyPair())}return r}var de=function(){function e(){this._secretKey=Buffer.alloc(0)}return e.fromBytes=function(t){var n=new e;return n._secretKey=t,n},e.fromString=function(t){var n=new e;return n._secretKey=Buffer.from(t,"hex"),n},e.random=function(){return e.fromBytes(Buffer.from(n.randomBytes(e.SEED_SIZE_BYTES)))},e.prototype.generateKeyPair=function(){var e=n.sign.keyPair.fromSeed(this._secretKey);return{publicKey:Buffer.from(e.publicKey).toString("hex"),privateKey:Buffer.from(e.secretKey).toString("hex")}},e.prototype.generateSubseed=function(t){var n=i.derivePath(t.toString(),this._secretKey.toString("hex")).key;return e.fromBytes(n)},e.prototype.toBytes=function(){return this._secretKey},e.prototype.toString=function(){return this._secretKey.toString("hex")},e.SEED_SIZE_BYTES=32,e}();function ce(e,t){if(t)if(0===t.type){var n=t;if(console.log(e+"Transaction Payload"),0===n.essence.type){if(n.essence.inputs){console.log(e+"\tInputs:",n.essence.inputs.length);for(var r=0,i=n.essence.inputs;r<i.length;r++){he(e+"\t\t",i[r])}}if(n.essence.outputs){console.log(e+"\tOutputs:",n.essence.outputs.length);for(var o=0,s=n.essence.outputs;o<s.length;o++){pe(e+"\t\t",s[o])}}ce(e+"\t",n.essence.payload)}if(n.unlockBlocks){console.log(e+"\tUnlock Blocks:",n.unlockBlocks.length);for(var a=0,u=n.unlockBlocks;a<u.length;a++){ge(e+"\t\t",u[a])}}}else if(1===t.type){n=t;console.log(e+"Milestone Payload"),console.log(e+"\tIndex:",n.index),console.log(e+"\tTimestamp:",n.timestamp),console.log(e+"\tInclusion Merkle Proof:",n.inclusionMerkleProof),console.log(e+"\tSignature:",n.signature)}else if(2===t.type){n=t;console.log(e+"Indexation Payload"),console.log(e+"\tIndex:",n.index),console.log(e+"\tData:",Buffer.from(n.data,"hex").toString())}}function le(e,t){if(t&&1===t.type){var n=t;console.log(e+"Ed25519 Address"),console.log(e+"\tAddress:",n.address)}}function fe(e,t){if(t&&1===t.type){var n=t;console.log(e+"Ed25519 Signature"),console.log(e+"\tPublic Key:",n.publicKey),console.log(e+"\tSignature:",n.signature)}}function he(e,t){if(t&&0===t.type){var n=t;console.log(e+"UTXO Input"),console.log(e+"\tTransaction Id:",n.transactionId),console.log(e+"\tTransaction Output Index:",n.transactionOutputIndex)}}function pe(e,t){if(t&&0===t.type){var n=t;console.log(e+"Signature Locked Single Output"),le(e+"\t\t",n.address),console.log(e+"\t\tAmount:",n.amount)}}function ge(e,t){if(t)if(0===t.type){var n=t;console.log(e+"\tSignature Unlock Block"),fe(e+"\t\t\t",n.signature)}else if(1===t.type){n=t;console.log(e+"\tReference Unlock Block"),console.log(e+"\t\tReference:",n.reference)}}var ye=function(){function e(e,t){void 0===t&&(t=0),this._buffer=e,this._readIndex=t}return e.prototype.length=function(){return this._buffer.length},e.prototype.hasRemaining=function(e){return this._readIndex+e<=this._buffer.length},e.prototype.unused=function(){return this._buffer.length-this._readIndex},e.prototype.readFixedBufferHex=function(e,t,n){if(void 0===n&&(n=!0),!this.hasRemaining(t))throw new Error(e+" length "+t+" exceeds the remaining data "+this.unused());var r=this._buffer.slice(this._readIndex,this._readIndex+t);return n&&(this._readIndex+=t),r.toString("hex")},e.prototype.readByte=function(e,t){if(void 0===t&&(t=!0),!this.hasRemaining(1))throw new Error(e+" length 1 exceeds the remaining data "+this.unused());var n=this._buffer.readUInt8(this._readIndex);return t&&(this._readIndex+=1),n},e.prototype.readUInt16=function(e,t){if(void 0===t&&(t=!0),!this.hasRemaining(2))throw new Error(e+" length 2 exceeds the remaining data "+this.unused());var n=this._buffer.readUInt16LE(this._readIndex);return t&&(this._readIndex+=2),n},e.prototype.readUInt32=function(e,t){if(void 0===t&&(t=!0),!this.hasRemaining(4))throw new Error(e+" length 4 exceeds the remaining data "+this.unused());var n=this._buffer.readUInt32LE(this._readIndex);return t&&(this._readIndex+=4),n},e.prototype.readUInt64=function(e,t){if(void 0===t&&(t=!0),!this.hasRemaining(8))throw new Error(e+" length 8 exceeds the remaining data "+this.unused());var n=this._buffer.readBigUInt64LE(this._readIndex);return t&&(this._readIndex+=8),n},e.prototype.readString=function(e,t){void 0===t&&(t=!0);var n=this.readUInt16(e);if(!this.hasRemaining(n))throw new Error(e+" length "+n+" exceeds the remaining data "+this.unused());var r=this._buffer.slice(this._readIndex,this._readIndex+n);return t&&(this._readIndex+=n),r.toString()},e}();e.ARRAY_LENGTH=2,e.BYTE_SIZE=1,e.Bip32Path=se,e.Blake2b=f,e.Client=l,e.ClientError=c,e.Ed25519=h,e.Ed25519Seed=de,e.MESSAGE_ID_LENGTH=p,e.MIN_ADDRESS_LENGTH=1,e.MIN_ED25519_ADDRESS_LENGTH=m,e.MIN_ED25519_SIGNATURE_LENGTH=H,e.MIN_INDEXATION_PAYLOAD_LENGTH=8,e.MIN_INPUT_LENGTH=1,e.MIN_MILESTONE_PAYLOAD_LENGTH=148,e.MIN_OUTPUT_LENGTH=1,e.MIN_PAYLOAD_LENGTH=4,e.MIN_REFERENCE_UNLOCK_BLOCK_LENGTH=3,e.MIN_SIGNATURE_LENGTH=1,e.MIN_SIGNATURE_UNLOCK_BLOCK_LENGTH=2,e.MIN_SIG_LOCKED_OUTPUT_LENGTH=T,e.MIN_TRANSACTION_ESSENCE_LENGTH=12,e.MIN_TRANSACTION_PAYLOAD_LENGTH=8,e.MIN_UNLOCK_BLOCK_LENGTH=1,e.MIN_UTXO_INPUT_LENGTH=_,e.ReadBuffer=ye,e.SMALL_TYPE_LENGTH=1,e.STRING_LENGTH=2,e.TRANSACTION_ID_LENGTH=g,e.TYPE_LENGTH=4,e.UINT16_SIZE=2,e.UINT32_SIZE=4,e.UINT64_SIZE=8,e.WriteBuffer=ae,e.deserializeAddress=I,e.deserializeEd25519Address=E,e.deserializeEd25519Signature=D,e.deserializeIndexationPayload=re,e.deserializeInput=B,e.deserializeInputs=v,e.deserializeMessage=function(e){if(!e.hasRemaining(oe))throw new Error("Message data is "+e.length()+" in length which is less than the minimimum size required of "+oe);var t=e.readByte("message.version");if(1!==t)throw new Error("Unsupported message version number: "+t);var n=e.readFixedBufferHex("message.parent1MessageId",p),r=e.readFixedBufferHex("message.parent2MessageId",p),i=$(e),o=e.readUInt64("message.nonce"),s=e.unused();if(0!==s)throw new Error("Message data length "+e.length()+" has unused data "+s);return{version:t,payload:i,parent1MessageId:n,parent2MessageId:r,nonce:Number(o)}},e.deserializeMilestonePayload=te,e.deserializeOutput=z,e.deserializeOutputs=N,e.deserializePayload=$,e.deserializeReferenceUnlockBlock=W,e.deserializeSigLockedSingleOutput=L,e.deserializeSignature=K,e.deserializeSignatureUnlockBlock=j,e.deserializeTransactionEssence=R,e.deserializeTransactionPayload=Q,e.deserializeUTXOInput=k,e.deserializeUnlockBlock=Z,e.deserializeUnlockBlocks=q,e.generateAddressKeyPairs=ue,e.isHex=y,e.logAddress=le,e.logInput=he,e.logMessage=function(e,t){console.log(e+"\tVersion:",t.version),console.log(e+"\tParent 1 Message Id:",t.parent1MessageId),console.log(e+"\tParent 2 Message Id:",t.parent2MessageId),ce(e+"\t",t.payload),void 0!==t.nonce&&console.log(e+"\tNonce:",t.nonce)},e.logOutput=pe,e.logPayload=ce,e.logSignature=fe,e.logUnlockBlock=ge,e.sendData=function(e,t,n){return u(this,void 0,Promise,(function(){var r,i,o;return d(this,(function(s){switch(s.label){case 0:return r={type:2,index:t,data:n},[4,e.tips()];case 1:return i=s.sent(),o={version:1,parent1MessageId:i.tip1MessageId,parent2MessageId:i.tip2MessageId,payload:r,nonce:0},[2,e.messageSubmit(o)]}}))}))},e.sendTransfer=function(e,t,n,r,i){return u(this,void 0,Promise,(function(){var o,s,a,u,c,l,f,p,g,y,m,I,w,E,x,_,v,S,B,k,b,T,N,P,z,L,O,R,H,K,G,D,C,q,F;return d(this,(function(d){switch(d.label){case 0:if(!n||0===n.length)throw new Error("You must specify some outputs");o=n.reduce((function(e,t){return e+t.amount}),0),s=0,a=0,u=[],c=!1,d.label=1;case 1:f=ue(t,s,20),p=0,g=f,d.label=2;case 2:return p<g.length?(y=g[p],[4,e.addressOutputs(h.signAddress(y.publicKey))]):[3,9];case 3:return 0!==(m=d.sent()).outputIds.length?[3,4]:(c=!0,l=y,[3,8]);case 4:I=0,w=m.outputIds,d.label=5;case 5:return I<w.length?(E=w[I],[4,e.output(E)]):[3,8];case 6:if((x=d.sent()).isSpent){if(0!==x.output.amount)throw new Error("Spent address")}else 0!==x.output.amount&&a<o&&(a+=x.output.amount,D={type:0,transactionId:x.transactionId,transactionOutputIndex:x.outputIndex},U(T=new ae,D),u.push({input:D,addressKeyPair:y,serialized:T.finalBuffer().toString("hex")}));d.label=7;case 7:return I++,[3,5];case 8:return p++,[3,2];case 9:s+=20,d.label=10;case 10:if(!c)return[3,1];d.label=11;case 11:if(a<o)throw new Error("There are not enough funds in the inputs for the required balance");for(o<a&&l&&(_=h.signAddress(l.publicKey),n.push({amount:a-o,address:_})),v=[],S=0,B=n;S<B.length;S++)k=B[S],b={type:0,address:{type:1,address:k.address},amount:k.amount},M(T=new ae,b),v.push({output:b,serialized:T.finalBuffer().toString("hex")});for(N=u.sort((function(e,t){return e.serialized.localeCompare(t.serialized)})),P=v.sort((function(e,t){return e.serialized.localeCompare(t.serialized)})),z={type:0,inputs:N.map((function(e){return e.input})),outputs:P.map((function(e){return e.output})),payload:r&&i?{type:2,index:r,data:i}:void 0},A(L=new ae,z),O=L.finalBuffer(),R=[],H={},K=0,G=N;K<G.length;K++)D=G[K],H[D.addressKeyPair.publicKey]?R.push({type:1,reference:H[D.addressKeyPair.publicKey].unlockIndex}):(R.push({type:0,signature:{type:1,publicKey:D.addressKeyPair.publicKey,signature:h.signData(D.addressKeyPair.privateKey,O)}}),H[D.addressKeyPair.publicKey]={keyPair:D.addressKeyPair,unlockIndex:R.length-1});return C={type:0,essence:z,unlockBlocks:R},[4,e.tips()];case 12:return q=d.sent(),F={version:1,parent1MessageId:q.tip1MessageId,parent2MessageId:q.tip2MessageId,payload:C,nonce:0},[4,e.messageSubmit(F)];case 13:return[2,{messageId:d.sent(),remainderAddress:_}]}}))}))},e.serializeAddress=w,e.serializeEd25519Address=x,e.serializeEd25519Signature=C,e.serializeIndexationPayload=ie,e.serializeInput=U,e.serializeInputs=S,e.serializeMessage=function(e,t){e.writeByte("message.version",t.version),e.writeFixedBufferHex("message.parent1MessageId",p,t.parent1MessageId),e.writeFixedBufferHex("message.parent2MessageId",p,t.parent2MessageId),V(e,t.payload),e.writeUInt64("message.nonce",BigInt(t.nonce))},e.serializeMilestonePayload=ne,e.serializeOutput=M,e.serializeOutputs=P,e.serializePayload=V,e.serializeReferenceUnlockBlock=X,e.serializeSigLockedSingleOutput=O,e.serializeSignature=G,e.serializeSignatureUnlockBlock=J,e.serializeTransactionEssence=A,e.serializeTransactionPayload=ee,e.serializeUTXOInput=b,e.serializeUnlockBlock=Y,e.serializeUnlockBlocks=F,Object.defineProperty(e,"__esModule",{value:!0})}));