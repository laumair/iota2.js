!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("cross-fetch"),require("tweetnacl"),require("blakejs"),require("crypto")):"function"==typeof define&&define.amd?define(["exports","cross-fetch","tweetnacl","blakejs","crypto"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Iota2={},e["cross-fetch"],e.tweetnacl,e.blakejs,e.crypto)}(this,(function(e,t,n,r,i){"use strict";function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var o=s(t),a=s(i),u=function(e,t){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function d(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{u(r.next(e))}catch(e){s(e)}}function a(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((r=r.apply(e,t||[])).next())}))}function c(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}var l=function(e){function t(t,n,r,i){var s=e.call(this,t)||this;return s.route=n,s.httpStatus=r,s.code=i,s}return function(e,t){function n(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t}(Error),f=function(){function e(e){if(!/^https?:\/\/\w+(\.\w+)*(:\d+)?(\/.*)?$/.test(e))throw new Error("The endpoint is not in the correct format");this._endpoint=e.replace(/\/+$/,"")}return e.prototype.health=function(){return d(this,void 0,Promise,(function(){var e;return c(this,(function(t){switch(t.label){case 0:return[4,this.fetchStatus("/health")];case 1:if(200===(e=t.sent()))return[2,!0];if(503===e)return[2,!1];throw new l("Unexpected response code","/health",e)}}))}))},e.prototype.info=function(){return d(this,void 0,Promise,(function(){return c(this,(function(e){return[2,this.fetchJson("get","/api/v1/info")]}))}))},e.prototype.tips=function(){return d(this,void 0,Promise,(function(){return c(this,(function(e){return[2,this.fetchJson("get","/api/v1/tips")]}))}))},e.prototype.message=function(e){return d(this,void 0,Promise,(function(){return c(this,(function(t){return[2,this.fetchJson("get","/api/v1/messages/"+e)]}))}))},e.prototype.messageMetadata=function(e){return d(this,void 0,Promise,(function(){return c(this,(function(t){return[2,this.fetchJson("get","/api/v1/messages/"+e+"/metadata")]}))}))},e.prototype.messageRaw=function(e){return d(this,void 0,Promise,(function(){return c(this,(function(t){return[2,this.fetchBinary("get","/api/v1/messages/"+e+"/raw")]}))}))},e.prototype.messageSubmit=function(e){return d(this,void 0,Promise,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.fetchJson("post","/api/v1/messages",e)];case 1:return[2,t.sent().messageId]}}))}))},e.prototype.messageSubmitRaw=function(e){return d(this,void 0,Promise,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,this.fetchBinary("post","/api/v1/messages",e)];case 1:return[2,t.sent().messageId]}}))}))},e.prototype.messagesFind=function(e){return d(this,void 0,Promise,(function(){return c(this,(function(t){return[2,this.fetchJson("get","/api/v1/messages?index="+encodeURIComponent(e))]}))}))},e.prototype.messageChildren=function(e){return d(this,void 0,Promise,(function(){return c(this,(function(t){return[2,this.fetchJson("get","/api/v1/messages/"+e+"/children")]}))}))},e.prototype.output=function(e){return d(this,void 0,Promise,(function(){return c(this,(function(t){return[2,this.fetchJson("get","/api/v1/outputs/"+e)]}))}))},e.prototype.address=function(e){return d(this,void 0,Promise,(function(){return c(this,(function(t){return[2,this.fetchJson("get","/api/v1/addresses/"+e)]}))}))},e.prototype.addressOutputs=function(e){return d(this,void 0,Promise,(function(){return c(this,(function(t){return[2,this.fetchJson("get","/api/v1/addresses/"+e+"/outputs")]}))}))},e.prototype.milestone=function(e){return d(this,void 0,Promise,(function(){return c(this,(function(t){return[2,this.fetchJson("get","/api/v1/milestones/"+e)]}))}))},e.prototype.fetchStatus=function(e){return d(this,void 0,Promise,(function(){return c(this,(function(t){switch(t.label){case 0:return[4,o.default(""+this._endpoint+e,{method:"get"})];case 1:return[2,t.sent().status]}}))}))},e.prototype.fetchJson=function(e,t,n){var r,i,s;return d(this,void 0,Promise,(function(){var a,u;return c(this,(function(d){switch(d.label){case 0:return[4,o.default(""+this._endpoint+t,{method:e,headers:{"Content-Type":"application/json"},body:n?JSON.stringify(n):void 0})];case 1:return[4,(a=d.sent()).json()];case 2:if(u=d.sent(),a.ok&&!u.error)return[2,u.data];throw new l(null!==(i=null===(r=u.error)||void 0===r?void 0:r.message)&&void 0!==i?i:a.statusText,t,a.status,null===(s=u.error)||void 0===s?void 0:s.code)}}))}))},e.prototype.fetchBinary=function(e,t,n){var r,i,s;return d(this,void 0,Promise,(function(){var a,u,d,f;return c(this,(function(c){switch(c.label){case 0:return[4,o.default(""+this._endpoint+t,{method:e,headers:{"Content-Type":"application/octet-stream"},body:n})];case 1:return(a=c.sent()).ok?"get"!==e?[3,3]:(f=(d=Buffer).from,[4,a.arrayBuffer()]):[3,5];case 2:return[2,f.apply(d,[c.sent()])];case 3:return[4,a.json()];case 4:if(!(null==(u=c.sent())?void 0:u.error))return[2,null==u?void 0:u.data];c.label=5;case 5:return u?[3,7]:[4,a.json()];case 6:u=c.sent(),c.label=7;case 7:throw new l(null!==(i=null===(r=null==u?void 0:u.error)||void 0===r?void 0:r.message)&&void 0!==i?i:a.statusText,t,a.status,null===(s=null==u?void 0:u.error)||void 0===s?void 0:s.code)}}))}))},e}(),h=function(){function e(){}return e.sum256=function(t){return Buffer.from(r.blake2b(Buffer.from(t,"hex"),void 0,e.SIZE_256)).toString("hex")},e.SIZE_256=32,e}(),p=function(){function e(){}return e.signData=function(e,t){return Buffer.from(n.sign.detached(t,Buffer.from(e,"hex"))).toString("hex")},e.verifyData=function(e,t,r){return n.sign.detached.verify(r,Buffer.from(t,"hex"),Buffer.from(e,"hex"))},e.publicKeyToAddress=function(e){return h.sum256(e)},e.verifyAddress=function(t,n){return e.publicKeyToAddress(t)===n},e.VERSION=1,e.PUBLIC_KEY_SIZE=32,e.SIGNATURE_SIZE=64,e.ADDRESS_LENGTH=h.SIZE_256,e}(),g=h.SIZE_256,y=h.SIZE_256;function m(e){return e.length%2!=1&&/[\da-f]/gi.test(e)}var I=1+p.ADDRESS_LENGTH;function w(e){if(!e.hasRemaining(1))throw new Error("Address data is "+e.length()+" in length which is less than the minimimum size required of 1");var t=e.readByte("address.type",!1);if(1!==t)throw new Error("Unrecognized address type "+t);return _(e)}function v(e,t){if(1!==t.type)throw new Error("Unrecognized address type "+t.type);x(e,t)}function _(e){if(!e.hasRemaining(I))throw new Error("Ed25519 address data is "+e.length()+" in length which is less than the minimimum size required of "+I);var t=e.readByte("ed25519Address.type");if(1!==t)throw new Error("Type mismatch in ed25519Address "+t);return{type:t,address:e.readFixedBufferHex("ed25519Address.address",p.ADDRESS_LENGTH)}}function x(e,t){e.writeByte("ed25519Address.type",t.type),e.writeFixedBufferHex("ed25519Address.address",p.ADDRESS_LENGTH,t.address)}var E=1+y+2;function b(e){for(var t=e.readUInt16("inputs.numInputs"),n=[],r=0;r<t;r++)n.push(B(e));return n}function S(e,t){e.writeUInt16("inputs.numInputs",t.length);for(var n=0;n<t.length;n++)U(e,t[n])}function B(e){if(!e.hasRemaining(1))throw new Error("Input data is "+e.length()+" in length which is less than the minimimum size required of 1");var t=e.readByte("input.type",!1);if(0!==t)throw new Error("Unrecognized input type "+t);return T(e)}function U(e,t){if(0!==t.type)throw new Error("Unrecognized input type "+t.type);k(e,t)}function T(e){if(!e.hasRemaining(E))throw new Error("UTXO Input data is "+e.length()+" in length which is less than the minimimum size required of "+E);var t=e.readByte("utxoInput.type");if(0!==t)throw new Error("Type mismatch in utxoInput "+t);return{type:t,transactionId:e.readFixedBufferHex("utxoInput.transactionId",y),transactionOutputIndex:e.readUInt16("utxoInput.transactionOutputIndex")}}function k(e,t){e.writeByte("utxoInput.type",t.type),e.writeFixedBufferHex("utxoInput.transactionId",y,t.transactionId),e.writeUInt16("utxoInput.transactionOutputIndex",t.transactionOutputIndex)}var P=2+I;function N(e){for(var t=e.readUInt16("outputs.numOutputs"),n=[],r=0;r<t;r++)n.push(M(e));return n}function z(e,t){e.writeUInt16("outputs.numOutputs",t.length);for(var n=0;n<t.length;n++)K(e,t[n])}function M(e){if(!e.hasRemaining(1))throw new Error("Output data is "+e.length()+" in length which is less than the minimimum size required of 1");var t=e.readByte("output.type",!1);if(0!==t)throw new Error("Unrecognized output type "+t);return A(e)}function K(e,t){if(0!==t.type)throw new Error("Unrecognized output type "+t.type);L(e,t)}function A(e){if(!e.hasRemaining(P))throw new Error("Signature Locked Single Output data is "+e.length()+" in length which is less than the minimimum size required of "+P);var t=e.readByte("sigLockedSingleOutput.type");if(0!==t)throw new Error("Type mismatch in sigLockedSingleOutput "+t);var n=w(e),r=e.readUInt64("sigLockedSingleOutput.amount");return{type:t,address:n,amount:Number(r)}}function L(e,t){e.writeByte("sigLockedSingleOutput.type",t.type),v(e,t.address),e.writeUInt64("sigLockedSingleOutput.amount",BigInt(t.amount))}function O(e){if(!e.hasRemaining(12))throw new Error("Transaction essence data is "+e.length()+" in length which is less than the minimimum size required of 12");var t=e.readUInt32("transactionEssence.type");if(0!==t)throw new Error("Type mismatch in transactionEssence "+t);var n=b(e),r=N(e),i=$(e);if(i&&2!==i.type)throw new Error("Transaction essence can only contain embedded Indexation Payload");return{type:t,inputs:n,outputs:r,payload:i}}function R(e,t){e.writeUInt32("transactionEssence.type",t.type),S(e,t.inputs),z(e,t.outputs),Q(e,t.payload)}var H=1+p.SIGNATURE_SIZE+p.PUBLIC_KEY_SIZE;function G(e){if(!e.hasRemaining(1))throw new Error("Signature data is "+e.length()+" in length which is less than the minimimum size required of 1");var t=e.readByte("signature.type",!1);if(1!==t)throw new Error("Unrecognized signature type "+t);return D(e)}function C(e,t){if(1!==t.type)throw new Error("Unrecognized signature type "+t.type);F(e,t)}function D(e){if(!e.hasRemaining(H))throw new Error("Ed25519 signature data is "+e.length()+" in length which is less than the minimimum size required of "+H);var t=e.readByte("ed25519Signature.type");if(1!==t)throw new Error("Type mismatch in ed25519Signature "+t);return{type:t,publicKey:e.readFixedBufferHex("ed25519Signature.publicKey",p.PUBLIC_KEY_SIZE),signature:e.readFixedBufferHex("ed25519Signature.signature",p.SIGNATURE_SIZE)}}function F(e,t){e.writeByte("ed25519Signature.type",t.type),e.writeFixedBufferHex("ed25519Signature.publicKey",p.PUBLIC_KEY_SIZE,t.publicKey),e.writeFixedBufferHex("ed25519Signature.signature",p.SIGNATURE_SIZE,t.signature)}function Z(e){for(var t=e.readUInt16("transactionEssence.numUnlockBlocks"),n=[],r=0;r<t;r++)n.push(Y(e));return n}function q(e,t){e.writeUInt16("transactionEssence.numUnlockBlocks",t.length);for(var n=0;n<t.length;n++)j(e,t[n])}function Y(e){if(!e.hasRemaining(1))throw new Error("Unlock Block data is "+e.length()+" in length which is less than the minimimum size required of 1");var t,n=e.readByte("unlockBlock.type",!1);if(0===n)t=J(e);else{if(1!==n)throw new Error("Unrecognized unlock block type "+n);t=X(e)}return t}function j(e,t){if(0===t.type)W(e,t);else{if(1!==t.type)throw new Error("Unrecognized unlock block type "+t.type);V(e,t)}}function J(e){if(!e.hasRemaining(2))throw new Error("Signature Unlock Block data is "+e.length()+" in length which is less than the minimimum size required of 2");var t=e.readByte("signatureUnlockBlock.type");if(0!==t)throw new Error("Type mismatch in signatureUnlockBlock "+t);return{type:t,signature:G(e)}}function W(e,t){e.writeByte("signatureUnlockBlock.type",t.type),C(e,t.signature)}function X(e){if(!e.hasRemaining(3))throw new Error("Reference Unlock Block data is "+e.length()+" in length which is less than the minimimum size required of 3");var t=e.readByte("referenceUnlockBlock.type");if(1!==t)throw new Error("Type mismatch in referenceUnlockBlock "+t);return{type:t,reference:e.readUInt16("referenceUnlockBlock.reference")}}function V(e,t){e.writeByte("referenceUnlockBlock.type",t.type),e.writeUInt16("referenceUnlockBlock.reference",t.reference)}function $(e){if(!e.hasRemaining(4))throw new Error("Payload data is "+e.length()+" in length which is less than the minimimum size required of 4");var t,n=e.readUInt32("payload.length");if(!e.hasRemaining(n))throw new Error("Payload length "+n+" exceeds the remaining data "+e.unused());if(n>0){var r=e.readUInt32("payload.type",!1);if(0===r)t=ee(e);else if(1===r)t=ne(e);else{if(2!==r)throw new Error("Unrecognized payload type "+r);t=ie(e)}}return t}function Q(e,t){var n=e.getWriteIndex();if(e.writeUInt32("payload.length",0),t)if(0===t.type)te(e,t);else if(1===t.type)re(e,t);else{if(2!==t.type)throw new Error("Unrecognized transaction type "+t.type);se(e,t)}else;var r=e.getWriteIndex();e.setWriteIndex(n),e.writeUInt32("payload.length",r-n-4),e.setWriteIndex(r)}function ee(e){if(!e.hasRemaining(8))throw new Error("Transaction Payload data is "+e.length()+" in length which is less than the minimimum size required of 8");var t=e.readUInt32("payloadTransaction.type");if(0!==t)throw new Error("Type mismatch in payloadTransaction "+t);if(0!==e.readUInt32("payloadTransaction.essenceType",!1))throw new Error("Unrecognized transaction essence type "+t);return{type:t,essence:O(e),unlockBlocks:Z(e)}}function te(e,t){if(e.writeUInt32("payloadMilestone.type",t.type),0!==t.type)throw new Error("Unrecognized transaction type "+t.type);R(e,t.essence),q(e,t.unlockBlocks)}function ne(e){if(!e.hasRemaining(148))throw new Error("Milestone Payload data is "+e.length()+" in length which is less than the minimimum size required of 148");var t=e.readUInt32("payloadMilestone.type");if(1!==t)throw new Error("Type mismatch in payloadMilestone "+t);var n=e.readUInt64("payloadMilestone.index"),r=e.readUInt64("payloadMilestone.timestamp"),i=e.readFixedBufferHex("payloadMilestone.inclusionMerkleProof",64),s=e.readFixedBufferHex("payloadMilestone.signature",64);return{type:t,index:Number(n),timestamp:Number(r),inclusionMerkleProof:i,signature:s}}function re(e,t){e.writeUInt32("payloadMilestone.type",t.type),e.writeUInt64("payloadMilestone.index",BigInt(t.index)),e.writeUInt64("payloadMilestone.timestamp",BigInt(t.timestamp)),e.writeFixedBufferHex("payloadMilestone.inclusionMerkleProof",64,t.inclusionMerkleProof),e.writeFixedBufferHex("payloadMilestone.signature",64,t.signature)}function ie(e){if(!e.hasRemaining(8))throw new Error("Indexation Payload data is "+e.length()+" in length which is less than the minimimum size required of 8");var t=e.readUInt32("payloadIndexation.type");if(2!==t)throw new Error("Type mismatch in payloadIndexation "+t);var n=e.readString("payloadIndexation.index"),r=e.readUInt32("payloadIndexation.dataLength");return{type:2,index:n,data:e.readFixedBufferHex("payloadIndexation.data",r)}}function se(e,t){e.writeUInt32("payloadIndexation.type",t.type),e.writeString("payloadIndexation.index",t.index),e.writeUInt32("payloadIndexation.dataLength",t.data.length/2),e.writeFixedBufferHex("payloadIndexation.data",t.data.length/2,t.data)}var oe=1+2*g+4+8;var ae=function(){function e(e){e?(this._path=e.split("/"),"m"===this._path[0]&&this._path.shift()):this._path=[]}return e.prototype.toString=function(){return this._path.length>0?"m/"+this._path.join("/"):"m"},e.prototype.push=function(e){this._path.push(""+e)},e.prototype.pushHardened=function(e){this._path.push(e+"'")},e.prototype.pop=function(){this._path.pop()},e.prototype.numberSegments=function(){return this._path.map((function(e){return Number.parseInt(e,10)}))},e}(),ue=a.default.createHmac,de=function(){function e(){}return e.getMasterKeyFromSeed=function(e){var t=ue("sha512","ed25519 seed").update(e).digest();return{privateKey:t.slice(0,32),chainCode:t.slice(32)}},e.derivePath=function(t,n){for(var r=e.getMasterKeyFromSeed(t),i=r.privateKey,s=r.chainCode,o=n.numberSegments(),a=0;a<o.length;a++){var u=Buffer.allocUnsafe(4);u.writeUInt32BE(2147483648+o[a],0);var d=Buffer.concat([Buffer.alloc(1,0),i,u]),c=ue("sha512",s).update(d).digest();i=c.slice(0,32),s=c.slice(32)}return{privateKey:i,chainCode:s}},e.getPublicKey=function(e,t){void 0===t&&(t=!0);var r=n.sign.keyPair.fromSeed(e),i=Buffer.from(r.secretKey.slice(32));return t?Buffer.concat([Buffer.alloc(1,0),i]):i},e}(),ce=function(){function e(){this._secretKey=Buffer.alloc(0)}return e.fromBytes=function(t){var n=new e;return n._secretKey=t,n},e.fromString=function(t){var n=new e;return n._secretKey=Buffer.from(t,"hex"),n},e.random=function(){return e.fromBytes(Buffer.from(n.randomBytes(e.SEED_SIZE_BYTES)))},e.prototype.keyPair=function(){var e=n.sign.keyPair.fromSeed(this._secretKey);return{publicKey:Buffer.from(e.publicKey).toString("hex"),privateKey:Buffer.from(e.secretKey).toString("hex")}},e.prototype.generateSeedFromPath=function(t){var n=de.derivePath(this._secretKey,t);return e.fromBytes(n.privateKey)},e.prototype.toBytes=function(){return this._secretKey},e.prototype.toString=function(){return this._secretKey.toString("hex")},e.SEED_SIZE_BYTES=32,e}(),le=20;function fe(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=le);for(var i=[],s=n;s<n+r;s++){t.push(s);var o=e.generateSeedFromPath(t);i.push(o.keyPair()),t.pop()}return i}var he=function(){function e(){this._buffer=Buffer.alloc(e.CHUNK_SIZE),this._writeIndex=0}return e.prototype.length=function(){return this._buffer.length},e.prototype.unused=function(){return this._buffer.length-this._writeIndex},e.prototype.finalBuffer=function(){return this._buffer.slice(0,this._writeIndex)},e.prototype.getWriteIndex=function(){return this._writeIndex},e.prototype.setWriteIndex=function(e){this._writeIndex=e},e.prototype.writeFixedBufferHex=function(e,t,n){if(!m(n))throw new Error("The "+n+" should be in hex format");if(2*t!==n.length)throw new Error(e+" length "+n.length+" does not match expected length "+2*t);this.expand(t),this._buffer.write(n,this._writeIndex,"hex"),this._writeIndex+=t},e.prototype.writeByte=function(e,t){this.expand(1),this._buffer.writeUInt8(t,this._writeIndex),this._writeIndex+=1},e.prototype.writeUInt16=function(e,t){this.expand(2),this._buffer.writeUInt16LE(t,this._writeIndex),this._writeIndex+=2},e.prototype.writeUInt32=function(e,t){this.expand(4),this._buffer.writeUInt32LE(t,this._writeIndex),this._writeIndex+=4},e.prototype.writeUInt64=function(e,t){this.expand(8),this._buffer.writeBigUInt64LE(t,this._writeIndex),this._writeIndex+=8},e.prototype.writeString=function(e,t){return this.writeUInt16(e,t.length),this.expand(t.length),this._buffer.write(t,this._writeIndex),this._writeIndex+=t.length,t},e.prototype.expand=function(t){this._writeIndex+t>this._buffer.byteLength&&(this._buffer=Buffer.concat([this._buffer,Buffer.alloc(e.CHUNK_SIZE)]))},e.CHUNK_SIZE=4096,e}();function pe(e,t,n,r,i,s,o){return d(this,void 0,Promise,(function(){var a,u,d,l,f,h,g,y,m,I,w,v,_,x,E,b,S,B,T,k,P,N,z,M,A,L,O,H,G,C,D,F,Z,q,Y;return c(this,(function(c){switch(c.label){case 0:if(!r||0===r.length)throw new Error("You must specify some outputs");a=r.reduce((function(e,t){return e+t.amount}),0),u=null!=i?i:0,d=0,l=[],f=!1,c.label=1;case 1:g=fe(t,n,u,le),y=0,m=g,c.label=2;case 2:return y<m.length?(I=m[y],[4,e.addressOutputs(p.publicKeyToAddress(I.publicKey))]):[3,9];case 3:return 0!==(w=c.sent()).outputIds.length?[3,4]:(f=!0,h=I,[3,8]);case 4:v=0,_=w.outputIds,c.label=5;case 5:return v<_.length?(x=_[v],[4,e.output(x)]):[3,8];case 6:if((E=c.sent()).isSpent){if(0!==E.output.amount)throw new Error("Spent address")}else 0!==E.output.amount&&d<a&&(d+=E.output.amount,F={type:0,transactionId:E.transactionId,transactionOutputIndex:E.outputIndex},U(N=new he,F),l.push({input:F,addressKeyPair:I,serialized:N.finalBuffer().toString("hex")}));c.label=7;case 7:return v++,[3,5];case 8:return y++,[3,2];case 9:u+=le,c.label=10;case 10:if(!f)return[3,1];c.label=11;case 11:if(d<a)throw new Error("There are not enough funds in the inputs for the required balance");for(a<d&&h&&(b=p.publicKeyToAddress(h.publicKey),r.push({amount:d-a,address:b})),S=[],B=0,T=r;B<T.length;B++)k=T[B],P={type:0,address:{type:1,address:k.address},amount:k.amount},K(N=new he,P),S.push({output:P,serialized:N.finalBuffer().toString("hex")});for(z=l.sort((function(e,t){return e.serialized.localeCompare(t.serialized)})),M=S.sort((function(e,t){return e.serialized.localeCompare(t.serialized)})),A={type:0,inputs:z.map((function(e){return e.input})),outputs:M.map((function(e){return e.output})),payload:s&&o?{type:2,index:s,data:o.toString("hex")}:void 0},R(L=new he,A),O=L.finalBuffer(),H=[],G={},C=0,D=z;C<D.length;C++)F=D[C],G[F.addressKeyPair.publicKey]?H.push({type:1,reference:G[F.addressKeyPair.publicKey].unlockIndex}):(H.push({type:0,signature:{type:1,publicKey:F.addressKeyPair.publicKey,signature:p.signData(F.addressKeyPair.privateKey,O)}}),G[F.addressKeyPair.publicKey]={keyPair:F.addressKeyPair,unlockIndex:H.length-1});return Z={type:0,essence:A,unlockBlocks:H},[4,e.tips()];case 12:return q=c.sent(),Y={version:1,parent1MessageId:q.tip1MessageId,parent2MessageId:q.tip2MessageId,payload:Z,nonce:0},[4,e.messageSubmit(Y)];case 13:return[2,{messageId:c.sent(),message:Y,remainderAddress:b}]}}))}))}function ge(e,t){if(t)if(0===t.type){var n=t;if(console.log(e+"Transaction Payload"),0===n.essence.type){if(n.essence.inputs){console.log(e+"\tInputs:",n.essence.inputs.length);for(var r=0,i=n.essence.inputs;r<i.length;r++){Ie(e+"\t\t",i[r])}}if(n.essence.outputs){console.log(e+"\tOutputs:",n.essence.outputs.length);for(var s=0,o=n.essence.outputs;s<o.length;s++){we(e+"\t\t",o[s])}}ge(e+"\t",n.essence.payload)}if(n.unlockBlocks){console.log(e+"\tUnlock Blocks:",n.unlockBlocks.length);for(var a=0,u=n.unlockBlocks;a<u.length;a++){ve(e+"\t\t",u[a])}}}else if(1===t.type){n=t;console.log(e+"Milestone Payload"),console.log(e+"\tIndex:",n.index),console.log(e+"\tTimestamp:",n.timestamp),console.log(e+"\tInclusion Merkle Proof:",n.inclusionMerkleProof),console.log(e+"\tSignature:",n.signature)}else if(2===t.type){n=t;console.log(e+"Indexation Payload"),console.log(e+"\tIndex:",n.index),console.log(e+"\tData:",Buffer.from(n.data,"hex").toString())}}function ye(e,t){if(t&&1===t.type){var n=t;console.log(e+"Ed25519 Address"),console.log(e+"\tAddress:",n.address)}}function me(e,t){if(t&&1===t.type){var n=t;console.log(e+"Ed25519 Signature"),console.log(e+"\tPublic Key:",n.publicKey),console.log(e+"\tSignature:",n.signature)}}function Ie(e,t){if(t&&0===t.type){var n=t;console.log(e+"UTXO Input"),console.log(e+"\tTransaction Id:",n.transactionId),console.log(e+"\tTransaction Output Index:",n.transactionOutputIndex)}}function we(e,t){if(t&&0===t.type){var n=t;console.log(e+"Signature Locked Single Output"),ye(e+"\t\t",n.address),console.log(e+"\t\tAmount:",n.amount)}}function ve(e,t){if(t)if(0===t.type){var n=t;console.log(e+"\tSignature Unlock Block"),me(e+"\t\t\t",n.signature)}else if(1===t.type){n=t;console.log(e+"\tReference Unlock Block"),console.log(e+"\t\tReference:",n.reference)}}var _e=function(){function e(e,t){void 0===t&&(t=0),this._buffer=e,this._readIndex=t}return e.prototype.length=function(){return this._buffer.length},e.prototype.hasRemaining=function(e){return this._readIndex+e<=this._buffer.length},e.prototype.unused=function(){return this._buffer.length-this._readIndex},e.prototype.readFixedBufferHex=function(e,t,n){if(void 0===n&&(n=!0),!this.hasRemaining(t))throw new Error(e+" length "+t+" exceeds the remaining data "+this.unused());var r=this._buffer.slice(this._readIndex,this._readIndex+t);return n&&(this._readIndex+=t),r.toString("hex")},e.prototype.readByte=function(e,t){if(void 0===t&&(t=!0),!this.hasRemaining(1))throw new Error(e+" length 1 exceeds the remaining data "+this.unused());var n=this._buffer.readUInt8(this._readIndex);return t&&(this._readIndex+=1),n},e.prototype.readUInt16=function(e,t){if(void 0===t&&(t=!0),!this.hasRemaining(2))throw new Error(e+" length 2 exceeds the remaining data "+this.unused());var n=this._buffer.readUInt16LE(this._readIndex);return t&&(this._readIndex+=2),n},e.prototype.readUInt32=function(e,t){if(void 0===t&&(t=!0),!this.hasRemaining(4))throw new Error(e+" length 4 exceeds the remaining data "+this.unused());var n=this._buffer.readUInt32LE(this._readIndex);return t&&(this._readIndex+=4),n},e.prototype.readUInt64=function(e,t){if(void 0===t&&(t=!0),!this.hasRemaining(8))throw new Error(e+" length 8 exceeds the remaining data "+this.unused());var n=this._buffer.readBigUInt64LE(this._readIndex);return t&&(this._readIndex+=8),n},e.prototype.readString=function(e,t){void 0===t&&(t=!0);var n=this.readUInt16(e);if(!this.hasRemaining(n))throw new Error(e+" length "+n+" exceeds the remaining data "+this.unused());var r=this._buffer.slice(this._readIndex,this._readIndex+n);return t&&(this._readIndex+=n),r.toString()},e}();e.ARRAY_LENGTH=2,e.BYTE_SIZE=1,e.Bip32Path=ae,e.Blake2b=h,e.ClientError=l,e.DEFAULT_CHUNK_SIZE=le,e.Ed25519=p,e.Ed25519Seed=ce,e.MESSAGE_ID_LENGTH=g,e.MIN_ADDRESS_LENGTH=1,e.MIN_ED25519_ADDRESS_LENGTH=I,e.MIN_ED25519_SIGNATURE_LENGTH=H,e.MIN_INDEXATION_PAYLOAD_LENGTH=8,e.MIN_INPUT_LENGTH=1,e.MIN_MILESTONE_PAYLOAD_LENGTH=148,e.MIN_OUTPUT_LENGTH=1,e.MIN_PAYLOAD_LENGTH=4,e.MIN_REFERENCE_UNLOCK_BLOCK_LENGTH=3,e.MIN_SIGNATURE_LENGTH=1,e.MIN_SIGNATURE_UNLOCK_BLOCK_LENGTH=2,e.MIN_SIG_LOCKED_OUTPUT_LENGTH=P,e.MIN_TRANSACTION_ESSENCE_LENGTH=12,e.MIN_TRANSACTION_PAYLOAD_LENGTH=8,e.MIN_UNLOCK_BLOCK_LENGTH=1,e.MIN_UTXO_INPUT_LENGTH=E,e.ReadBuffer=_e,e.SMALL_TYPE_LENGTH=1,e.STRING_LENGTH=2,e.SingleNodeClient=f,e.Slip0010=de,e.TRANSACTION_ID_LENGTH=y,e.TYPE_LENGTH=4,e.UINT16_SIZE=2,e.UINT32_SIZE=4,e.UINT64_SIZE=8,e.WriteBuffer=he,e.deserializeAddress=w,e.deserializeEd25519Address=_,e.deserializeEd25519Signature=D,e.deserializeIndexationPayload=ie,e.deserializeInput=B,e.deserializeInputs=b,e.deserializeMessage=function(e){if(!e.hasRemaining(oe))throw new Error("Message data is "+e.length()+" in length which is less than the minimimum size required of "+oe);var t=e.readByte("message.version");if(1!==t)throw new Error("Unsupported message version number: "+t);var n=e.readFixedBufferHex("message.parent1MessageId",g),r=e.readFixedBufferHex("message.parent2MessageId",g),i=$(e),s=e.readUInt64("message.nonce"),o=e.unused();if(0!==o)throw new Error("Message data length "+e.length()+" has unused data "+o);return{version:t,payload:i,parent1MessageId:n,parent2MessageId:r,nonce:Number(s)}},e.deserializeMilestonePayload=ne,e.deserializeOutput=M,e.deserializeOutputs=N,e.deserializePayload=$,e.deserializeReferenceUnlockBlock=X,e.deserializeSigLockedSingleOutput=A,e.deserializeSignature=G,e.deserializeSignatureUnlockBlock=J,e.deserializeTransactionEssence=O,e.deserializeTransactionPayload=ee,e.deserializeUTXOInput=T,e.deserializeUnlockBlock=Y,e.deserializeUnlockBlocks=Z,e.getAddressBalances=function(e,t){return d(this,void 0,Promise,(function(){var n,r,i,s,o,a,u,d,l,f;return c(this,(function(c){switch(c.label){case 0:n=[],r=0,i=t,c.label=1;case 1:return r<i.length?(s=i[r],[4,e.addressOutputs(s)]):[3,8];case 2:o=c.sent(),a=0,u=0,d=o.outputIds,c.label=3;case 3:return u<d.length?(l=d[u],[4,e.output(l)]):[3,6];case 4:(f=c.sent()).isSpent||(a+=f.output.amount),c.label=5;case 5:return u++,[3,3];case 6:n.push(a),c.label=7;case 7:return r++,[3,1];case 8:return[2,n]}}))}))},e.getAddresses=function(e,t,n,r){return void 0===n&&(n=0),void 0===r&&(r=le),fe(e,t,n,r).map((function(e){return p.publicKeyToAddress(e.publicKey)}))},e.getAddressesKeyPairs=fe,e.getAllUnspentAddresses=function(e,t,n,r){return d(this,void 0,Promise,(function(){var i,s,o,a,u,d,l,f,h,g,y,m;return c(this,(function(c){switch(c.label){case 0:i=null!=r?r:0,s=!1,o=[],c.label=1;case 1:a=fe(t,n,i,le),u=0,c.label=2;case 2:return u<a.length?(d=p.publicKeyToAddress(a[u].publicKey),[4,e.addressOutputs(d)]):[3,9];case 3:l=c.sent(),f=0,h=0,g=l.outputIds,c.label=4;case 4:return h<g.length?(y=g[h],[4,e.output(y)]):[3,7];case 5:(m=c.sent()).isSpent||0===m.output.amount||(f+=m.output.amount),c.label=6;case 6:return h++,[3,4];case 7:0===f?s=!0:o.push({address:d,index:i+u,amount:f}),c.label=8;case 8:return u++,[3,2];case 9:i+=le,c.label=10;case 10:if(!s)return[3,1];c.label=11;case 11:return[2,o]}}))}))},e.getBalance=function(e,t,n,r){return d(this,void 0,Promise,(function(){var i,s,o,a,u,d,l,f,h,g,y;return c(this,(function(c){switch(c.label){case 0:i=null!=r?r:0,s=!1,o=0,c.label=1;case 1:a=fe(t,n,i,le),u=0,c.label=2;case 2:return u<a.length?(d=p.publicKeyToAddress(a[u].publicKey),[4,e.addressOutputs(d)]):[3,9];case 3:return 0!==(l=c.sent()).outputIds.length?[3,4]:(s=!0,[3,8]);case 4:f=0,h=l.outputIds,c.label=5;case 5:return f<h.length?(g=h[f],[4,e.output(g)]):[3,8];case 6:0===(y=c.sent()).output.amount?s=!0:y.isSpent||(o+=y.output.amount),c.label=7;case 7:return f++,[3,5];case 8:return u++,[3,2];case 9:i+=le,c.label=10;case 10:if(!s)return[3,1];c.label=11;case 11:return[2,o]}}))}))},e.getUnspentAddress=function(e,t,n,r){return d(this,void 0,Promise,(function(){var i,s,o,a,u,d,l,f,h,g,y,m,I;return c(this,(function(c){switch(c.label){case 0:i=null!=r?r:0,s=!1,u=0,c.label=1;case 1:d=fe(t,n,i,le),l=0,c.label=2;case 2:return l<d.length?(f=p.publicKeyToAddress(d[l].publicKey),[4,e.addressOutputs(f)]):[3,10];case 3:return 0!==(h=c.sent()).outputIds.length?[3,4]:(s=!0,[3,8]);case 4:g=0,y=h.outputIds,c.label=5;case 5:return g<y.length?(m=y[g],[4,e.output(m)]):[3,8];case 6:0===(I=c.sent()).output.amount?s=!0:I.isSpent||(o=f,a=i+l,u+=I.output.amount),c.label=7;case 7:return g++,[3,5];case 8:o&&(s=!0),c.label=9;case 9:return l++,[3,2];case 10:i+=le,c.label=11;case 11:if(!s)return[3,1];c.label=12;case 12:return[2,o&&void 0!==a?{address:o,index:a,amount:u}:void 0]}}))}))},e.isHex=m,e.logAddress=ye,e.logInput=Ie,e.logMessage=function(e,t){console.log(e+"\tVersion:",t.version),console.log(e+"\tParent 1 Message Id:",t.parent1MessageId),console.log(e+"\tParent 2 Message Id:",t.parent2MessageId),ge(e+"\t",t.payload),void 0!==t.nonce&&console.log(e+"\tNonce:",t.nonce)},e.logOutput=we,e.logPayload=ge,e.logSignature=me,e.logUnlockBlock=ve,e.retrieveData=function(e,t){return d(this,void 0,Promise,(function(){var n,r;return c(this,(function(i){switch(i.label){case 0:return[4,e.message(t)];case 1:return(null==(n=i.sent())?void 0:n.payload)&&(r=void 0,0===n.payload.type?r=n.payload.essence.payload:2===n.payload.type&&(r=n.payload),r)?[2,{index:r.index,data:Buffer.from(r.data,"hex")}]:[2]}}))}))},e.send=function(e,t,n,r,i,s){return d(this,void 0,Promise,(function(){var o;return c(this,(function(a){switch(a.label){case 0:return[4,pe(e,t,n,[{address:r,amount:i}],s)];case 1:return[2,{messageId:(o=a.sent()).messageId,message:o.message}]}}))}))},e.sendAdvanced=pe,e.sendData=function(e,t,n){return d(this,void 0,Promise,(function(){var r,i,s,o;return c(this,(function(a){switch(a.label){case 0:return r={type:2,index:t,data:n.toString("hex")},[4,e.tips()];case 1:return i=a.sent(),s={version:1,parent1MessageId:i.tip1MessageId,parent2MessageId:i.tip2MessageId,payload:r,nonce:0},[4,e.messageSubmit(s)];case 2:return o=a.sent(),[2,{message:s,messageId:o}]}}))}))},e.serializeAddress=v,e.serializeEd25519Address=x,e.serializeEd25519Signature=F,e.serializeIndexationPayload=se,e.serializeInput=U,e.serializeInputs=S,e.serializeMessage=function(e,t){e.writeByte("message.version",t.version),e.writeFixedBufferHex("message.parent1MessageId",g,t.parent1MessageId),e.writeFixedBufferHex("message.parent2MessageId",g,t.parent2MessageId),Q(e,t.payload),e.writeUInt64("message.nonce",BigInt(t.nonce))},e.serializeMilestonePayload=re,e.serializeOutput=K,e.serializeOutputs=z,e.serializePayload=Q,e.serializeReferenceUnlockBlock=V,e.serializeSigLockedSingleOutput=L,e.serializeSignature=C,e.serializeSignatureUnlockBlock=W,e.serializeTransactionEssence=R,e.serializeTransactionPayload=te,e.serializeUTXOInput=k,e.serializeUnlockBlock=j,e.serializeUnlockBlocks=q,Object.defineProperty(e,"__esModule",{value:!0})}));